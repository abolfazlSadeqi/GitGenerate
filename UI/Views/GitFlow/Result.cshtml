@using Core
@model BranchPlan
@{
    ViewData["Title"] = "Branch Plan";
    var lang = ViewBag.Lang ?? "en";

    // متن‌ها بر اساس زبان
    var texts = new Dictionary<string, string>
    {
        ["back"] = lang == "fa" ? "بازگشت" : "Back",
        ["branchPlan"] = lang == "fa" ? "برنامه شاخه" : "Branch Plan",
        ["commands"] = lang == "fa" ? "دستورات" : "Commands",
        ["copyCommands"] = lang == "fa" ? "کپی دستورات" : "Copy commands",
        ["copyTag"] = lang == "fa" ? "کپی تگ پیشنهادی" : "Copy suggested tag",
        ["releaseNotes"] = lang == "fa" ? "یادداشت‌های Release / توضیح" : "Release Notes / Description",
        ["summary"] = lang == "fa" ? "خلاصه" : "Summary",
        ["branch"] = lang == "fa" ? "شاخه" : "Branch",
        ["suggestedTag"] = lang == "fa" ? "تگ پیشنهادی" : "Suggested tag",
        ["steps"] = lang == "fa" ? "مراحل" : "Steps",
        ["followCommands"] = lang == "fa" ? "دستورالعمل‌ها را در پنل دستورات دنبال کنید" : "Follow commands panel",
        ["quickActions"] = lang == "fa" ? "عملیات سریع" : "Quick actions",
        ["copyAll"] = lang == "fa" ? "کپی تمام دستورات" : "Copy All Commands",
        ["generatedBy"] = lang == "fa" ? "تولید شده توسط GitFlow Generator • قبل از ارسال به origin دستورالعمل تیم خود را رعایت کنید."
                                    : "Generated by GitFlow Generator • Follow your team's policies before pushing to origin."
    };
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container my-5">
    <a href="/GitFlow/New" class="btn btn-outline-secondary mb-3">&larr; @texts["back"]</a>

    <div class="row g-4">
        <div class="col-md-7">
            <div class="card shadow-sm p-3 rounded-4">
                <h4>@texts["branchPlan"]: <span class="badge bg-info text-dark">@Model.BranchName</span></h4>
                <p class="text-muted">@Model.Summary</p>

                <div class="mb-3">
                    <label class="form-label">@texts["commands"]</label>
                    <pre id="commandsBlock" style="background:#f8f9fa;padding:12px;border-radius:8px;height:320px;overflow:auto;">@string.Join("\n", Model.Commands)</pre>
                    <div class="d-flex justify-content-end gap-2 mt-2">
                        <button class="btn btn-outline-secondary" onclick="copyCommands()">@texts["copyCommands"]</button>
                        @if (!string.IsNullOrWhiteSpace(Model.SuggestedTag))
                        {
                            <button class="btn btn-outline-primary" onclick="copyTag()">@texts["copyTag"]</button>
                        }
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">@texts["releaseNotes"]</label>
                    <div class="p-3 border rounded" style="min-height:80px">@Model.ReleaseNotes</div>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            <div class="card shadow-sm p-3 rounded-4">
                <h5>@texts["summary"]</h5>
                <ul class="list-unstyled">
                    <li><strong>@texts["branch"]:</strong> @Model.BranchName</li>
                    @if (!string.IsNullOrWhiteSpace(Model.SuggestedTag))
                    {
                        <li><strong>@texts["suggestedTag"]:</strong> <span class="badge bg-warning text-dark">@Model.SuggestedTag</span></li>
                    }
                    <li><strong>@texts["steps"]:</strong> <span class="text-muted">@texts["followCommands"]</span></li>
                </ul>

                <div class="mt-3">
                    <label class="form-label">@texts["quickActions"]</label>
                    <div class="d-grid gap-2">
                        <a class="btn btn-success" href="#" onclick="copyCommands(); return false;">@texts["copyAll"]</a>
                    </div>
                </div>

                <div class="mt-4 text-muted small">
                    @texts["generatedBy"]
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyCommands() {
            const txt = document.getElementById('commandsBlock').innerText;
            navigator.clipboard.writeText(txt).then(()=> {
                alert('@(lang == "fa" ? "دستورات در کلیپ‌بورد کپی شد" : "Commands copied to clipboard")');
            });
        }
        function copyTag(){
            const tag = '@Model.SuggestedTag';
            navigator.clipboard.writeText(tag).then(()=> {
                alert('@(lang == "fa" ? "تگ در کلیپ‌بورد کپی شد" : "Tag copied to clipboard")');
            });
        }
    </script>
}
