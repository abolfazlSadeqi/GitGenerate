@using Core
@using Microsoft.AspNetCore.Html
@model VersionList

@{
    ViewData["Title"] = "Version Dashboard";
    string lang = ViewBag.Lang ?? "en";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<div class="container my-5">
    <h1 class="mb-5 text-center">Semantic Versioning Dashboard</h1>

    <div class="row g-4">
        <!-- Version Overview Card -->
        <div class="col-12">
            <div class="card shadow-sm rounded-4 p-4 hover-card">
                <h3 class="fw-bold mb-3"><i class="fa-solid fa-layer-group me-2"></i>Version Overview</h3>
                <div class="row row-cols-1 row-cols-md-2 g-3">
                    <div class="col">
                        <div class="p-3 border rounded-3 bg-light">
                            <h5><i class="fa-solid fa-fire me-2 text-danger"></i>Major Version</h5>
                            <p>@(Model.MajorDescription.ContainsKey(lang) ? Model.MajorDescription[lang] : Model.MajorDescription["en"])</p>
                        </div>
                    </div>
                    <div class="col">
                        <div class="p-3 border rounded-3 bg-light">
                            <h5><i class="fa-solid fa-plus me-2 text-success"></i>Minor Version</h5>
                            <p>@(Model.MinorDescription.ContainsKey(lang) ? Model.MinorDescription[lang] : Model.MinorDescription["en"])</p>
                        </div>
                    </div>
                    <div class="col">
                        <div class="p-3 border rounded-3 bg-light">
                            <h5><i class="fa-solid fa-bug me-2 text-warning"></i>Patch Version</h5>
                            <p>@(Model.PatchDescription.ContainsKey(lang) ? Model.PatchDescription[lang] : Model.PatchDescription["en"])</p>
                        </div>
                    </div>
                    <div class="col">
                        <div class="p-3 border rounded-3 bg-light">
                            <h5><i class="fa-solid fa-hourglass-half me-2 text-info"></i>Pre-release</h5>
                            <p>@(Model.PreReleaseDescription.ContainsKey(lang) ? Model.PreReleaseDescription[lang] : Model.PreReleaseDescription["en"])</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <h5 class="fw-bold"><i class="fa-solid fa-scroll me-2"></i>Release Notes</h5>
                    <p>@(Model.Description.ContainsKey(lang) ? Model.Description[lang] : Model.Description["en"])</p>
                </div>
            </div>
        </div>

        <!-- Accordion Sections -->
        <div class="col-12">
            <div class="accordion" id="accordionMain">
                @RenderAccordion("Rules", Model.Rules, lang, "fa-solid fa-gavel text-primary")
                @RenderAccordion("Challenges", Model.Challenges, lang, "fa-solid fa-triangle-exclamation text-warning")
                @RenderAccordion("Solutions", Model.Solutions, lang, "fa-solid fa-lightbulb text-success")
                @RenderAccordion("Notes", Model.Notes, lang, "fa-solid fa-sticky-note text-info")
                @RenderAccordion("Best Practices", Model.BestPractices, lang, "fa-solid fa-check-double text-success")
                @RenderAccordion("Common Mistakes", Model.Mistakes, lang, "fa-solid fa-xmark text-danger")
            </div>
        </div>
    </div>
</div>

<style>
    .hover-card:hover {
        transform: translateY(-5px);
        transition: all 0.3s ease-in-out;
        box-shadow: 0 12px 25px rgba(0,0,0,0.2) !important;
    }

    .accordion-button::after {
        transform: rotate(90deg);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

@functions {
    private IHtmlContent RenderAccordion(string title, Dictionary<string, List<string>> dict, string lang, string iconClass)
    {
        if (dict == null || dict.Count == 0) return new HtmlString("");

        var list = dict.ContainsKey(lang) ? dict[lang] : dict["en"];
        if (list == null || !list.Any()) return new HtmlString("");

        string id = "accordion-" + Guid.NewGuid().ToString("N").Substring(0, 8);

        var itemsHtml = string.Join("", list.Select(i => $"<li>{i}</li>"));

        string html = $@"
        <div class='accordion-item mb-2'>
            <h2 class='accordion-header' id='heading-{id}'>
                <button class='accordion-button collapsed rounded-3' type='button' data-bs-toggle='collapse' data-bs-target='#{id}' aria-expanded='false'>
                    <i class='{iconClass} me-2'></i> {title} <span class='ms-2 badge bg-secondary'>{list.Count}</span>
                </button>
            </h2>
            <div id='{id}' class='accordion-collapse collapse'>
                <div class='accordion-body bg-light rounded-3'><ul>{itemsHtml}</ul></div>
            </div>
        </div>";

        return new HtmlString(html);
    }
}
